<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Conflation of distributions • tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Conflation of distributions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Conflation of distributions</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Ballen and Sandra Reinales</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/conflation.Rmd" class="external-link"><code>vignettes/conflation.Rmd</code></a></small>
      <div class="d-none name"><code>conflation.Rmd</code></div>
    </div>

    
    
<p>Combining different distributions into a single one is a useful tool
for summarising different sources of information. Given a collection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
distributions describing the same parameter, we aim at building a
general distribution which incorporates information from the individual
components. Multiple alternatives are available, and as with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>-intercept
estimation, the problem of summarising a collection of distributions has
several possible answers. Hill (2011)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Hill, T. (2011). Conflations of probability
distributions. Transactions of the American Mathematical Society,
363(6), 3351-3372.&lt;/p&gt;"><sup>1</sup></a> discussed these methods and proposed the
conflation as a better and general way of combining distributions
describing the same parameter.</p>
<p>Conflation proves useful when building secondary calibrations where
more than two densities are available for the same time event. Suppose
that we have a biogeographic event with time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>,
for which three different studies provide three independent densities,
for instance, posterior probabilities for a node which corresponds to
the biogeographic event. The best summary of these independent pieces of
information is a conflation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>&amp;</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>P</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>P</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>P</mi><mn>3</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Q(\tau) = \&amp;(P_1(\tau), P_2(\tau), P_3(\tau))</annotation></semantics></math>,
which can be used as a secondary calibration point for a new divergence
time estimation analysis as it is itself a PDF. Suppose that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>1</mn></msub><mo>=</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>10</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_1 = N(10,1)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>2</mn></msub><mo>=</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>13</mn><mo>,</mo><mn>0.5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_2 = N(13,0.5)</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>3</mn></msub><mo>=</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>14.4</mn><mo>,</mo><mn>1.7</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_3 = N(14.4,1.7)</annotation></semantics></math>.
We can calculate the conflation of these three distributions.</p>
<p>Here, three normals were used to approximate the posterior
distribution of a given divergence time, and their conflation is
depicted as a black line. It is evident that the conflated distribution
shows more resemblance with the component with lowest variance (blue
distribution), although incorporating the information coming from all of
them. This distribution can in turn be used as a secondary calibration
point in a subsequent divergence time estimation study, where a single
node calibration must be used for a given node.</p>
<p>The function <code>conflate</code> is used for building a conflation
given arbitrary PDFs available in, that is, any function
<code>dDIST</code> (e.g., <code>dnorm</code>, <code>dexp</code>, etc.).
It uses a constructor function <code>density_fun</code> that helps to
specify the functions without need to calculate any object
beforehand.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaballench/tbea" class="external-link">tbea</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the conflation and plot it</span></span>
<span><span class="co"># mind the double quotes which must be used when specifying each distribution</span></span>
<span><span class="co"># and the single quotes when specifying the distribution function name</span></span>
<span><span class="fu"><a href="../reference/conflate.html">conflate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"density_fun(x, 'dnorm', mean=10, sd=1)"</span>,</span>
<span>           <span class="st">"density_fun(x, 'dnorm', mean=13, sd=0.5)"</span>,</span>
<span>           <span class="st">"density_fun(x, 'dnorm', mean=14.4, sd=1.7)"</span><span class="op">)</span>,</span>
<span>         from<span class="op">=</span><span class="fl">0</span>, to<span class="op">=</span><span class="fl">20</span>, n<span class="op">=</span><span class="fl">101</span>, add<span class="op">=</span><span class="cn">FALSE</span>, plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the individual distributions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="../reference/density_fun.html">density_fun</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'dnorm'</span>, mean<span class="op">=</span><span class="fl">10</span>, sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="../reference/density_fun.html">density_fun</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'dnorm'</span>, mean<span class="op">=</span><span class="fl">13</span>, sd<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="../reference/density_fun.html">density_fun</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">'dnorm'</span>, mean<span class="op">=</span><span class="fl">14.4</span>, sd<span class="op">=</span><span class="fl">1.7</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"green4"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topleft"</span>, lty<span class="op">=</span><span class="fl">1</span>,</span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Normal(10,1)"</span>,</span>
<span>                <span class="st">"Normal(13,0.5)"</span>,</span>
<span>                <span class="st">"Normal(14.4,1.7)"</span>,</span>
<span>                <span class="st">"Conflation of normals"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green4"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="conflation_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save the conflation coordinates into an object without plotting</span></span>
<span><span class="co"># then we can plot or use the xy values if desired</span></span>
<span><span class="va">conflated_normals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/conflate.html">conflate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"density_fun(x, 'dnorm', mean=0, sd=1)"</span>,</span>
<span>                                <span class="st">"density_fun(x, 'dnorm', mean=3, sd=1)"</span><span class="op">)</span>,</span>
<span>                              from<span class="op">=</span><span class="op">-</span><span class="fl">4</span>, to<span class="op">=</span><span class="fl">4</span>, n<span class="op">=</span><span class="fl">101</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">conflated_normals</span><span class="op">)</span></span></code></pre></div>
<p><img src="conflation_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<p>Now, we can use the conflated distribution as a secondary calibration
point for a new divergence time estimation analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, let's calculate the area under the curve,</span></span>
<span><span class="co"># must be approximately 1.0 as it is itself a PDF</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span><span class="op">(</span><span class="va">conflated_normals</span><span class="op">)</span>, subdivisions<span class="op">=</span><span class="fl">10000</span>,</span>
<span>          lower<span class="op">=</span><span class="op">-</span><span class="fl">4</span>, upper<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0.999997 with absolute error &lt; 8.2e-07</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># now, use 'quantile_conflation' to calculate quantiles</span></span>
<span><span class="co"># for the conflated distribution</span></span>
<span><span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantile_conflation.html">quantile_conflation</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.025</span>, data<span class="op">=</span><span class="va">conflated_normals</span>,</span>
<span>                          output<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span></span>
<span><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantile_conflation.html">quantile_conflation</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.5</span>, data<span class="op">=</span><span class="va">conflated_normals</span>,</span>
<span>                          output<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span></span>
<span><span class="va">q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantile_conflation.html">quantile_conflation</a></span><span class="op">(</span>p<span class="op">=</span><span class="fl">0.975</span>, data<span class="op">=</span><span class="va">conflated_normals</span>,</span>
<span>                          output<span class="op">=</span><span class="st">"quantile"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can use the function <code>findParams</code> to find the
combination of parameters given these quantiles, to set the new
calibration point (see function vignette for details).</p>

  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
