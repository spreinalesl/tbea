<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Posterior tree distribution â€¢ tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Posterior tree distribution">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Posterior tree distribution</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Ballen and Sandra Reinales</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/posterior_tree_distribution.Rmd" class="external-link"><code>vignettes/posterior_tree_distribution.Rmd</code></a></small>
      <div class="d-none name"><code>posterior_tree_distribution.Rmd</code></div>
    </div>

    
    
<p>There are two steps necessary for summarizing tree samples. One is to
decide how many distinct topologies (disregarding branch lengths) are in
the collection of trees, and then we need to summarize branch lengths
for each of these tree subsets using any sensible summary measure (e.g.,
mean or median). The functions <code>topoFreq</code> and
<code>summaryBrlen</code> aid in these two tasks respectively.
<code>topoFreq</code> uses the Robinson-Foulds (RF) distance among trees
in order to find clusters which are identical in topology and then bind
them together in a list that we can later operate over. The RF distance
is defined over unrooted trees, so it is necessary to check whether the
input trees are. Unrooting a rooted tree will destroy the root node and
then add up together both adjacent branch lengths, and this will be
reflected when summarizing with<code>summaryBrlens</code> using the
output of <code>topoFreq</code>. This will return one branch length less
than the number present in the original sample of rooted trees.
Accordingly, this method will only work on collections of unrooted
trees, or collections of time trees of fixed topology where we are only
interested in finding a summary values for branch lengths. It should not
be used when both the topology and divergence times are being
coestimated (e.g., when the posterior of trees comes from not fixing the
topology as in <code>Beast2</code>, <code>RevBayes</code>, and
<code>MrBayes</code>), but it is perfectly fine when the inference was
done to estimate only the unrooted topology and branch lengths, such as
in standard tree inference in <code>MrBayes</code>.</p>
<p>We see an example using these two functions below where we want to
use the median branch length for each group:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaballench/tbea" class="external-link">tbea</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># these urls render correctly on html but not on pdf. The former is more important for CRAN.</span></span>
<span><span class="co"># download the trees from the supplementary material of Ballen et al. (2022)</span></span>
<span><span class="va">t1</span><span class="op">&lt;-</span><span class="st">"https://raw.githubusercontent.com/gaballench/cynodontidaeWare/refs/heads/main/bayesian/mrbayes"</span></span>
<span><span class="va">t2</span><span class="op">&lt;-</span><span class="st">"https://raw.githubusercontent.com/gaballench/cynodontidaeWare/refs/heads/main/bayesian/mrbayes"</span></span>
<span></span>
<span><span class="va">mtr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">t1</span>, <span class="st">"concatenatedMolmorph.nexus.run1.t"</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mtr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.nexus.html" class="external-link">read.nexus</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">t2</span>, <span class="st">"concatenatedMolmorph.nexus.run2.t"</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mtr1</span>, <span class="va">mtr2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate topological frequencies</span></span>
<span><span class="va">tpf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topoFreq.html">topoFreq</a></span><span class="op">(</span><span class="va">trees</span>, output<span class="op">=</span><span class="st">"trees"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summarize median branch length</span></span>
<span><span class="va">sumtrees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summaryBrlen.html">summaryBrlen</a></span><span class="op">(</span><span class="va">tpf</span><span class="op">$</span><span class="va">trees</span>, method<span class="op">=</span><span class="st">"median"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sort the frequencies in decreasing order</span></span>
<span><span class="va">decreasingIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tpf</span><span class="op">$</span><span class="va">fabs</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># how many topologies comprise about 90% of the trees?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">tpf</span><span class="op">$</span><span class="va">fabs</span><span class="op">[</span><span class="va">decreasingIdx</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tpf</span><span class="op">$</span><span class="va">fabs</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">0.9</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot these four trees with branch lengths already summarized</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>oma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sumtrees</span><span class="op">[[</span><span class="va">decreasingIdx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>         type<span class="op">=</span><span class="st">"unrooted"</span>,</span>
<span>         show.node.label<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>         cex<span class="op">=</span><span class="fl">0.4</span>,</span>
<span>         main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tpf</span><span class="op">$</span><span class="va">frel</span><span class="op">[</span><span class="va">decreasingIdx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="posterior_tree_distribution_files/figure-html/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;"></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
