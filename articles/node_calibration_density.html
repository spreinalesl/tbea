<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Node calibration specification • tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Node calibration specification">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Node calibration specification</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Ballen and Sandra Reinales</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/node_calibration_density.Rmd" class="external-link"><code>vignettes/node_calibration_density.Rmd</code></a></small>
      <div class="d-none name"><code>node_calibration_density.Rmd</code></div>
    </div>

    
    
<p>When using time information associated to a fossil as calibration
prior, age uncertainty usually come from biostratigraphy (e.g., if no
radiometric estimate applies closer in the stratigraphic context to the
fossil locality). Then, it is possible to represent that uncertainity
using a Uniform distribution with first and last time parameters (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>40.94</mn><annotation encoding="application/x-tex">40.94</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>41.6</mn><annotation encoding="application/x-tex">41.6</annotation></semantics></math>
Ma respectively), or a Lognormal distribution with soft bounds. In the
second case, we need to find the combination of mean and standard
deviation that better describes a distribution whose density values
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.0</mn><annotation encoding="application/x-tex">0.0</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.5</mn><annotation encoding="application/x-tex">0.5</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.975</mn><annotation encoding="application/x-tex">0.975</annotation></semantics></math>
correspond to the quantiles defined by the uniform prior above, in order
to use the age information to set a calibration point. The function
<code>findParams</code> finds such combination of parameters for a given
pair of quantiles. As the standard Lognormal distribution is defined
between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>∞</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0,\infty)</annotation></semantics></math>,
we need to apply an offset towards the minimum age. This will make it
possible to relax the rather strong assumption about the node age,
because by using a uniform prior the probability of observing times with
fall outside the interval is zero.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaballench/tbea" class="external-link">tbea</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we need to substract the minimum to each quantile</span></span>
<span><span class="co"># to offset later</span></span>
<span><span class="fu"><a href="../reference/findParams.html">findParams</a></span><span class="op">(</span>q<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.94</span><span class="op">-</span><span class="fl">40.94</span>, <span class="fl">41.27</span><span class="op">-</span><span class="fl">40.94</span>, <span class="fl">41.60</span><span class="op">-</span><span class="fl">40.94</span><span class="op">)</span>,</span>
<span>           p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">0.50</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>           output<span class="op">=</span><span class="st">"complete"</span>,</span>
<span>           pdfunction<span class="op">=</span><span class="st">"plnorm"</span>,</span>
<span>           params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"meanlog"</span>, <span class="st">"sdlog"</span><span class="op">)</span>,</span>
<span>           initVals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $par</span></span>
<span><span class="co">## [1] -1.1085098  0.3538003</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $value</span></span>
<span><span class="co">## [1] 3.501584e-08</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts</span></span>
<span><span class="co">## function gradient </span></span>
<span><span class="co">##       89       NA </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $convergence</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $message</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>The function recovers the mean (in log scale) as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>1.1085098</mn></mrow><annotation encoding="application/x-tex">-1.1085098</annotation></semantics></math>
and the standard deviation as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.3538003</mn><annotation encoding="application/x-tex">0.3538003</annotation></semantics></math>.
We can therefore define in <code>Beast2</code> a calibration density
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>1.1085098</mn><mo>,</mo><mn>0.3538003</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">LN(-1.1085098, 0.3538003)</annotation></semantics></math>
(setting <code>meanInRealSpace</code> to false in <code>beauti</code>)
in the divergence time estimation analysis. We can further plot the
lognormal density as it would be used by <code>Beast2</code> with the
function <code>lognormalBeast</code>; please note that the values from
and to are counted in units from the offset, not in real scale):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/lognormalBeast.html">lognormalBeast</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.1085098</span>, <span class="fl">0.3538003</span>, meanInRealSpace<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                    offset<span class="op">=</span><span class="fl">40.94</span>, from<span class="op">=</span><span class="fl">0</span>, to<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>     type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, main<span class="op">=</span><span class="st">"Node calibration for Hydrolycus"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Time (Ma)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="node_calibration_density_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Alternatively, we may prefer to use an exponential distribution
instead of the lognormal because it relies on just one parameter instead
of two. The function <code>findParams</code> can be used again to
estimate prior parameters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/findParams.html">findParams</a></span><span class="op">(</span>q<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40.94</span><span class="op">-</span><span class="fl">40.94</span>, <span class="fl">41.60</span><span class="op">-</span><span class="fl">40.94</span><span class="op">)</span>,</span>
<span>           p<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>,  <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>           output<span class="op">=</span><span class="st">"complete"</span>,</span>
<span>           pdfunction<span class="op">=</span><span class="st">"pexp"</span>,</span>
<span>           params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rate"</span><span class="op">)</span>,</span>
<span>           initVals<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $par</span></span>
<span><span class="co">## [1] 5.589202</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $value</span></span>
<span><span class="co">## [1] 2.129363e-14</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts</span></span>
<span><span class="co">## function gradient </span></span>
<span><span class="co">##       20       19 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $convergence</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $message</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the calibration density</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html" class="external-link">curve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">dexp</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="fl">40.94</span><span class="op">)</span>, rate<span class="op">=</span><span class="fl">5.589202</span><span class="op">)</span>, from<span class="op">=</span><span class="fl">40.94</span>, to<span class="op">=</span><span class="fl">43</span>,</span>
<span>      main<span class="op">=</span><span class="st">"Node calibration for Hydrolycus"</span>,</span>
<span>      xlab<span class="op">=</span><span class="st">"Time (Ma)"</span>, ylab<span class="op">=</span><span class="st">"Density"</span><span class="op">)</span></span></code></pre></div>
<p><img src="node_calibration_density_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Note that the exponential distribution can be parametrized in terms
of the scale
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mi>λ</mi></mrow><annotation encoding="application/x-tex">1/\lambda</annotation></semantics></math>,
as is the case for <code>Beast2</code>) or the rate
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>)
as used by <code>R</code>. Therefore the value to input when defining
the prior of an exponential distribution in <code>beauti</code> is,
which in our case is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>/</mi><mn>5.589202</mn><mo>=</mo><mn>5.8</mn></mrow><annotation encoding="application/x-tex">1/5.589202 = 5.8</annotation></semantics></math>.
When plotting the prior in <code>R</code> (e.g. using the function
<code>curve</code> as above) we need to use
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
(i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.17</mn><annotation encoding="application/x-tex">0.17</annotation></semantics></math>)
rather than the mean.</p>
<p>Finally, note that although the function <code>findParams</code>
gives us the prior parameters to be used as calibration point, when we
use the uncertainty from the dating of a given fossil as the calibration
density, we mean the fossil age to be also the node age. This may be a
strong assumption about the position of the fossil, an then we may want
to use the fossil just as a lower bound instead, as extensively
suggested in the literature, e.g., Parham et al. (2012) <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Parham, J. et al. (2012). Best practices for justifying
fossil calibrations. Systematic Biology, 61(2):346-359.&lt;/p&gt;"><sup>1</sup></a>.</p>

  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
