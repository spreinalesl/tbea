<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stratigraphic intervals • tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stratigraphic intervals">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Stratigraphic intervals</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Balen and Sandra Reinales</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/stratigraphic_intervals.Rmd" class="external-link"><code>vignettes/stratigraphic_intervals.Rmd</code></a></small>
      <div class="d-none name"><code>stratigraphic_intervals.Rmd</code></div>
    </div>

    
    
<p>Some methods are available for estimating the confidence intervals on
the extreme points of a stratigraphic interval, i.e., an estimate for
the point of appearance and disappearance of a given taxon in geologic
time. These methods are relevant here since we can think of a
biogeographic events in the same way as taxa appear and become extinct.
This approach is lacking in historical biogeography as far as we know,
and seems to fit the main goal of determining the final point of
connection between biogeographic areas. Marshall (2010)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Marshall, C.R. (2010). Using confidence intervals to
quantify the uncertainty in the end-points of stratigraphic ranges.
Quantitative Methods in Paleobiology, 16:291-316.&lt;/p&gt;"><sup>1</sup></a> summarised different
approaches for estimating confidence intervals under certain sampling
regimes, assumptions and confidence levels, ranging from classical to
Bayesian estimators. The package <code>tbea</code> implements two of
these methods, the classical (Strauss and Sadler, 1989)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Strauss, D. and Sadler, P.M. (1989). Classical
confidence intervals and Bayesian probability estimates for ends of
local taxon ranges. Mathematical Geology, 21(4):411-427.&lt;/p&gt;"><sup>2</sup></a> and the
distribution-free estimator of Marshall (1994)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Marshall, C.R. (1994). Confidence intervals on
stratigraphic ranges: Partial relaxation of the assumption of randomly
distributed fossil horizons. Paleobiology, 20(4):459-469.&lt;/p&gt;"><sup>3</sup></a>.</p>
<p>The first method provides estimators where one-
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>θ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\theta_{1}</annotation></semantics></math>)
or two-parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mn>1</mn></msub><mo>,</mo><msub><mi>θ</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\theta_{1}, \theta_{2}</annotation></semantics></math>)
cases are constructed adding and subtracting a portion
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
of the magnitude of the observed stratigraphic interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>y</mi><mo>,</mo><mi>z</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[y, z]</annotation></semantics></math>.
Such constant depends on the confidence level wanted (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>).</p>
<p>The second method of distribution-free confidence intervals was
developed without assuming any particular distribution of underlying gap
sizes, instead, it calculates quantiles of gap size between occurrence
points for an ordered vector of gap sizes. The major cost is that such
intervals are larger that classical CIs and on the other hand, require
much more data for constructing intervals of high confidence (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>).</p>
<p>The method makes use of the binomial distribution in order to find
the quantiles that satisfy the condition of being smaller that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
and from these picking the largest (in the case of the lower bound) and
the smallest (for the upper bound). Marshall (1994) mentioned that
inference using his method is only valid as long as there is no trend in
gap size (i.e., a trend of increase or decrease in gap size as we go
along the time data). It is possible to use the Mann-Kendall test for
monotonic trend to test such assumption. Because the method works with
quantiles of the sorted gap sizes, these are first calculated from the
sorted vector of times, but then internally sorted when using the method
“Marshall94”; however, whether there is any monotonic trend must be
assessed on the unsorted version. We use the Mann-Kendall test on the
times vector prior to applying the function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.uwo.ca/faculty/aim" class="external-link">Kendall</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaballench/tbea" class="external-link">tbea</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">andes</span><span class="op">)</span></span>
<span><span class="va">andes</span> <span class="op">&lt;-</span> <span class="va">andes</span><span class="op">$</span><span class="va">ages</span></span>
<span></span>
<span><span class="co"># remove missing data</span></span>
<span><span class="va">andes</span> <span class="op">&lt;-</span> <span class="va">andes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">andes</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># remove outliers</span></span>
<span><span class="va">andes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">andes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">andes</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">gapsizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">andes</span><span class="op">)</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">andes</span><span class="op">[</span><span class="va">x</span><span class="op">]</span> <span class="op">-</span> <span class="va">andes</span><span class="op">[</span><span class="va">x</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the Mann-Kendall test </span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Kendall/man/MannKendall.html" class="external-link">MannKendall</a></span><span class="op">(</span><span class="va">gapsizes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## tau = 0.119, 2-sided pvalue =0.27337</span></span></code></pre>
<p>We fail to reject the null hypothesis of no monotonic trend in the
gap sizes. Therefore we may apply the “Marshall94” method for bracketing
the confidence interval.</p>
<p>These two methods are available in the function <code>stratCI</code>
which allows to pick one of two methods: “StraussSadler89” or
“Marshall94”. We can use the same data from the previous block in order
to illustrate the usage of the function <code>stratCI</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the older theta that is an extension beyond</span></span>
<span><span class="co"># the oldest (first from past to present) occurrence</span></span>
<span><span class="co"># using the method Strauss-Sadler89</span></span>
<span><span class="fu"><a href="../reference/stratCI.html">stratCI</a></span><span class="op">(</span>times<span class="op">=</span><span class="va">andes</span>, method<span class="op">=</span><span class="st">"Strauss-Sadler89"</span>,</span>
<span>        nparams<span class="op">=</span><span class="st">"one.par"</span>, C<span class="op">=</span><span class="fl">0.95</span>, endpoint<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     minObs     maxObs     maxEst          H     alphaR      alpha </span></span>
<span><span class="co">##  0.2749000  6.9500000  7.4435055 43.0000000  0.4935055  0.0739323</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the lower and upper bounds on the confidence interval with a quantile 0.8</span></span>
<span><span class="fu"><a href="../reference/stratCI.html">stratCI</a></span><span class="op">(</span>times<span class="op">=</span><span class="va">andes</span>, method<span class="op">=</span><span class="st">"Marshall94"</span>,</span>
<span>        confidence<span class="op">=</span><span class="fl">0.95</span>, quantile<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 7.0701 7.2147</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/stratCI.html">stratCI</a></span><span class="op">(</span>times<span class="op">=</span><span class="va">andes</span>, method<span class="op">=</span><span class="st">"Marshall94"</span>,</span>
<span>        confidence<span class="op">=</span><span class="fl">0.95</span>, quantile<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in .upperBound(confidence, length(gapsizes), quantile): Impossible to</span></span>
<span><span class="co">## calculate upper bound</span></span></code></pre>
<pre><code><span><span class="co">## [1] 7.14   NA</span></span></code></pre>
<p>As Marshall (1994) already noted, the method requires a large number
of gaps to calculate both bounds for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>
confidence interval; for our dataset with just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>42</mn><annotation encoding="application/x-tex">42</annotation></semantics></math>
gaps (i.e.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>43</mn><annotation encoding="application/x-tex">43</annotation></semantics></math>
times), we can find both bounds at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>80</mn><annotation encoding="application/x-tex">80%</annotation></semantics></math>
confidence level (or lower), and thus claim that the lower and upper
bounds for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>
confidence interval are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7.07</mn><mo>−</mo><mn>7.2</mn></mrow><annotation encoding="application/x-tex">7.07-7.2</annotation></semantics></math>
Ma. When we raise the confidence level to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>,
we can only infer the lower bound, thus being able just to claim that
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>
confidence interval is at least as old as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7.14</mn><annotation encoding="application/x-tex">7.14</annotation></semantics></math>
Ma. The higher the confidence level for finding the bounds on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>
confidence interval, the better, in a similar way as calculating a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>95</mn><annotation encoding="application/x-tex">95%</annotation></semantics></math>
confidence interval is better than calculating a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>70</mn><annotation encoding="application/x-tex">70%</annotation></semantics></math>
confidence interval.</p>
<p>We can plot these extensions after the oldest occurrence and compare
the results of both methods:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the confidence interval on the oldest time using the</span></span>
<span><span class="co"># Strauss-Sadler89 method</span></span>
<span><span class="va">straussSadlerAndes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratCI.html">stratCI</a></span><span class="op">(</span>times<span class="op">=</span><span class="va">andes</span>, method<span class="op">=</span><span class="st">"Strauss-Sadler89"</span>,</span>
<span>                              nparams<span class="op">=</span><span class="st">"one.par"</span>, C<span class="op">=</span><span class="fl">0.95</span>, endpoint<span class="op">=</span><span class="st">"first"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate the confidence interval under the distribution-free approach</span></span>
<span><span class="va">marshallAndes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratCI.html">stratCI</a></span><span class="op">(</span>times<span class="op">=</span><span class="va">andes</span>, method<span class="op">=</span><span class="st">"Marshall94"</span>,</span>
<span>                         confidence<span class="op">=</span><span class="fl">0.95</span>, quantile<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the estimations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">andes</span>, probability<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>     col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html" class="external-link">rgb</a></span><span class="op">(</span>red<span class="op">=</span><span class="fl">0</span>, green<span class="op">=</span><span class="fl">0</span>, blue<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"CIs based on stratigraphic intervals"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Age (Ma)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the lines  for the classical CI estimator of Strauss and Sadler</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="va">straussSadlerAndes</span><span class="op">[</span><span class="st">"maxObs"</span><span class="op">]</span>, y0<span class="op">=</span><span class="fl">0.025</span>,</span>
<span>       x1<span class="op">=</span><span class="va">straussSadlerAndes</span><span class="op">[</span><span class="st">"maxEst"</span><span class="op">]</span>, y1<span class="op">=</span><span class="fl">0.025</span>,</span>
<span>       code<span class="op">=</span><span class="fl">3</span>, angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.1</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the lines for the CI estimator of Marshall 94</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="va">marshallAndes</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y0<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>       x1<span class="op">=</span><span class="va">marshallAndes</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, y1<span class="op">=</span><span class="fl">0.05</span>,</span>
<span>       code<span class="op">=</span><span class="fl">3</span>, angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.1</span>, lwd<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">"darkgreen"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot a legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Strauss and Sadler \'89"</span>, <span class="st">"Marshall \'94"</span><span class="op">)</span>,</span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="stratigraphic_intervals_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>

  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
