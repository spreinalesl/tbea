<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to tbea • tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to tbea">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to tbea</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Ballen</h4>
            
            <h4 data-toc-skip class="date">2025-08-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/intro.Rmd" class="external-link"><code>vignettes/intro.Rmd</code></a></small>
      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<p>This vignette deals with more real-world examples than the
documentation examples. It complements the user manual and eventual
published references on the usage of the package.</p>
<p>The main place in evolutionary biology where the features contained
in <code>tbea</code> belong is in the core of divergence time estimation
and incorporation of paleontological and geological information into
estimation of the time component of phylogenies and diversification
analyses. Here, the tools present in the package aid in implementing
information from these fields into Bayesian analyses, mainly through
specification of priors, the most conspicuous feature of Bayesian
inference. However, prior specification is a very difficult task and
there are few if any rules to follow, along with a lot of
misunderstanding along with clearly-unjustified practices.</p>
<div class="section level2">
<h2 id="priors">Priors<a class="anchor" aria-label="anchor" href="#priors"></a>
</h2>
<p>Prior specification depends strongly on what we are trying to use in
order to calibrate a given phylogeny. For instance, node calibration and
tip calibration work in different ways, and prior specification will not
only depend on this but also on the nature of the information we are
trying to use as priors.</p>
<p>In the most common case, we have a fossil taxon (or occurrence) that
could inform us about the age of a given node (node calibration).
However, we lack exact information on two things: When the organism
lived (measured without error), and when a given diversification event
took place (i.e., the exact age of a node). What we have is a fossil,
whose age has been inferred or measured <em>with error</em> or
<em>uncertainty</em>. It is this information, uncertainty, what we
expect to model through priors (or at lease what should be done in real
life). A prior is in itself a probability density function (PDF
hereafter), that is, a mathematical function describing the probability
that a variable take a given value inside an given interval. More or
less precise statements can be made with aid of PDFs, such as that it is
more likely that a variable X takes a value between values a and b than
rather between c and d; or which is the expected value for the variable
of interest.</p>
<p>Now, what we have is age information such as the following
instances:</p>
<ul>
<li><p>The fossil comes from a volcanic layer that has been dated with
radiometric techniques with a specific value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
uncertainty, for instance, 40.6
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
0.5 Ma, where 0.5 is the standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</p></li>
<li><p>The fossil comes from a sedimentary unit that is said to be of
Miocene age (5.33 to 23.03 Ma).</p></li>
<li><p>The fossil comes from a layer bracketed by two levels with
volcanic ash that have been dated as 10.2
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
0.2 and 12.4
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>±</mo><annotation encoding="application/x-tex">\pm</annotation></semantics></math>
0.4 respectively. So, the fossil itself have an age determined as
interpolated between the layers that have real age information.</p></li>
</ul>
<p>How can we convert this information into legitimate priors?</p>
<div class="section level3">
<h3 id="the-findparams-function">The <code>findParams</code> function<a class="anchor" aria-label="anchor" href="#the-findparams-function"></a>
</h3>
<p>Given that we have prior on the age of a fossil to be 1 - 10 Ma and
that we want to model it with a lognormal distribution, fin the
parameters of the PDF that best reflect the uncertainty in question
(i.e., the parameters for which the observed quantiles are 1, 5.5, and
10, assuming that we want the midpoint to reflect the mean of the
PDF:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tbea</span><span class="fu">::</span><span class="fu"><a href="../reference/findParams.html">findParams</a></span><span class="op">(</span>q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5.5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>          p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,  <span class="fl">0.50</span>, <span class="fl">0.975</span><span class="op">)</span>,</span>
<span>          output <span class="op">=</span> <span class="st">"complete"</span>,</span>
<span>          pdfunction <span class="op">=</span> <span class="st">"plnorm"</span>,</span>
<span>          params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"meanlog"</span>, <span class="st">"sdlog"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in tbea::findParams(q = c(1, 5.5, 10), p = c(0.025, 0.5, 0.975), :</span></span>
<span><span class="co">## initVals not provided, will use the mean of quantiles in q for _each_ of the</span></span>
<span><span class="co">## parameters. Parameter estimates might not be reliable even though convergence</span></span>
<span><span class="co">## is reported.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.5962890625, sdlog =</span></span>
<span><span class="co">## -1.83852539062498): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.5962890625, sdlog =</span></span>
<span><span class="co">## -1.83852539062498): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 0.397998046874998, sdlog =</span></span>
<span><span class="co">## -1.16190185546872): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 0.840979003906248, sdlog =</span></span>
<span><span class="co">## -0.149819946289039): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.3444351196289, sdlog =</span></span>
<span><span class="co">## -0.0238803863525183): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.83548833280802, sdlog =</span></span>
<span><span class="co">## -0.291388470306973): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.86174815893173, sdlog =</span></span>
<span><span class="co">## -0.0716773837804601): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## Warning in plnorm(q = c(1, 5.5, 10), meanlog = 1.7567301876843, sdlog =</span></span>
<span><span class="co">## -0.09538053739814): NaNs produced</span></span></code></pre>
<pre><code><span><span class="co">## $par</span></span>
<span><span class="co">## [1] 1.704744 0.305104</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $value</span></span>
<span><span class="co">## [1] 0.0006250003</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts</span></span>
<span><span class="co">## function gradient </span></span>
<span><span class="co">##      101       NA </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $convergence</span></span>
<span><span class="co">## [1] 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $message</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Now we have a published study that specified a lognormal prior (with
or without justification, that’s another question) and we want to
actually plot it outside of <code>beauti</code>, for instance, in order
to assess similarity between the posterior and the prior. How can we
plot it in R and use its data as any other statistical density?</p>
</div>
<div class="section level3">
<h3 id="the-lognormalbeast-function">The <code>lognormalBeast</code> function<a class="anchor" aria-label="anchor" href="#the-lognormalbeast-function"></a>
</h3>
<p>Generate a matrix for the lognormal density with mean 1 and standard
deviation 1, with mean <em>in real space</em>, and spanning values in x
from 0 to 10, and then plot it:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lnvals</span> <span class="op">&lt;-</span> <span class="fu">tbea</span><span class="fu">::</span><span class="fu"><a href="../reference/lognormalBeast.html">lognormalBeast</a></span><span class="op">(</span>M <span class="op">=</span> <span class="fl">1</span>, S <span class="op">=</span> <span class="fl">1</span>, meanInRealSpace <span class="op">=</span> <span class="cn">TRUE</span>, from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lnvals</span>, type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="density-similarity">Density similarity<a class="anchor" aria-label="anchor" href="#density-similarity"></a>
</h2>
<p>One hot topic in model and tool comparisons is the similarity of the
posterior to the prior, that is, how much could our results resemble de
distribution set in the prior. For instance, if the posterior is
identical to the prior, that means that the likelihood (or the data) is
not providing information, and this is very risky as there would be the
potential to manipulate the results of Bayesian analyses.</p>
<div class="section level3">
<h3 id="the-measuresimil-function">The <code>measureSimil</code> function<a class="anchor" aria-label="anchor" href="#the-measuresimil-function"></a>
</h3>
<p>Measure and plot the similarity between two distributions partially
overlapping:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1985</span><span class="op">)</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"lightgray"</span><span class="op">)</span></span>
<span><span class="va">below</span> <span class="op">&lt;-</span> <span class="fu">tbea</span><span class="fu">::</span><span class="fu"><a href="../reference/measureSimil.html">measureSimil</a></span><span class="op">(</span>d1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>, mean <span class="op">=</span> <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       d2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000000</span>, mean <span class="op">=</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       main <span class="op">=</span> <span class="st">"Partial similarity"</span>,</span>
<span>                       colors <span class="op">=</span> <span class="va">colors</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"topright"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">below</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-4-1.png" width="700">
The number in the legend indicates an overlap of 0.13, and as such, a
measure of similarity between the densities.</p>
</div>
</div>
<div class="section level2">
<h2 id="geochronology">Geochronology<a class="anchor" aria-label="anchor" href="#geochronology"></a>
</h2>
<p>In the third case of possible age estimates for our calibrations, can
we clump together a number of age estimates from several samples in
order to build a general uncertainty for the interval?</p>
<p>Do the age estimates for the boundaries of the Honda Group (i.e.,
samples at meters 56.4 and 675.0) conform to the isochron
hypothesis?</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">laventa</span><span class="op">)</span></span>
<span><span class="va">hondaIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">laventa</span><span class="op">$</span><span class="va">elevation</span> <span class="op">==</span> <span class="fl">56.4</span> <span class="op">|</span> <span class="va">laventa</span><span class="op">$</span><span class="va">elevation</span> <span class="op">==</span> <span class="fl">675.0</span><span class="op">)</span> </span>
<span><span class="fu"><a href="../reference/mswd.test.html">mswd.test</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">laventa</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="va">hondaIndex</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">laventa</span><span class="op">$</span><span class="va">one_sigma</span><span class="op">[</span><span class="va">hondaIndex</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3.697832e-11</span></span></code></pre>
<p>The p-value is smaller than the nominal alpha of 0.05, so we can
reject the null hypothesis of isochron conditions.</p>
<p>Do the age estimates for the samples JG-R 88-2 and JG-R 89-2 conform
to the isochron hypothesis?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twoLevelsIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">laventa</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"JG-R 89-2"</span> <span class="op">|</span> <span class="va">laventa</span><span class="op">$</span><span class="va">sample</span> <span class="op">==</span> <span class="st">"JG-R 88-2"</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="va">laventa</span><span class="op">[</span><span class="va">twoLevelsIndex</span>, <span class="op">]</span></span>
<span><span class="co"># Remove the values 21 and 23 because of their abnormally large standard deviations</span></span>
<span><span class="fu">tbea</span><span class="fu">::</span><span class="fu"><a href="../reference/mswd.test.html">mswd.test</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">age</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">21</span>, <span class="op">-</span><span class="fl">23</span><span class="op">)</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">one_sigma</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">21</span>, <span class="op">-</span><span class="fl">23</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.993701</span></span></code></pre>
<p>The p-value is larger than the nominal alpha of 0.05, so we cannot
reject the null hypothesis of isochron conditions</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
