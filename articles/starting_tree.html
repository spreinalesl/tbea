<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Starting trees and how to specify them â€¢ tbea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Starting trees and how to specify them">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concatenation.html">Concatenation</a></li>
    <li><a class="dropdown-item" href="../articles/conflation.html">Conflation of distributions</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to tbea</a></li>
    <li><a class="dropdown-item" href="../articles/l_calibration_mcmctree.html">Specification of the Truncated Cauchy calibration density in MCMCTree</a></li>
    <li><a class="dropdown-item" href="../articles/node_calibration_density.html">Node calibration specification</a></li>
    <li><a class="dropdown-item" href="../articles/posterior_tree_distribution.html">Posterior tree distribution</a></li>
    <li><a class="dropdown-item" href="../articles/prior_posterior_comparisons.html">Prior-Posterior comparisons</a></li>
    <li><a class="dropdown-item" href="../articles/starting_tree.html">Starting trees and how to specify them</a></li>
    <li><a class="dropdown-item" href="../articles/stratigraphic_intervals.html">Stratigraphic intervals</a></li>
    <li><a class="dropdown-item" href="../articles/whyInitVals.html">Why to use the mean of the quantiles as initial values in `optim`?</a></li>
    <li><a class="dropdown-item" href="../articles/x_intercept.html">Inference using x-intercept methods</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaballench/tbea/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Starting trees and how to specify them</h1>
                        <h4 data-toc-skip class="author">Gustavo A.
Ballen and Sandra Reinales</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gaballench/tbea/blob/main/vignettes/starting_tree.Rmd" class="external-link"><code>vignettes/starting_tree.Rmd</code></a></small>
      <div class="d-none name"><code>starting_tree.Rmd</code></div>
    </div>

    
    
<p>Initial trees are used in three different ways in a divergence time
estimation analysis: Random trees when (i) the topology and divergence
times are co-estimated (e.g., <code>Beast2</code>), and user-defined
trees when (ii) complex analyses are carried out comprising several
terminals and multiple calibration points, and therefore a good initial
tree helps reach convergence, and (iii) when we want to fix the topology
and just estimate divergence times.</p>
<p>However, node times must be compatible with the calibration
densities, otherwise, the likelihood of the initial tree is zero, and
thus, their posterior probability. This generates an issue in programs
such as <code>Beast2</code> which will try a finite (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>100</mn><annotation encoding="application/x-tex">100</annotation></semantics></math>)
number of tree proposals; if all these fail, the analysis will not
start.</p>
<p>Initial trees are challenging to prepare by hand because they need to
be consistent with all node calibrations, in order to the initial
product of likelihood and priors is different from zero. Node times need
to be within the domain of the calibration distribution, so that branch
length need to be specified accordingly. We can infer initial trees
using a fast method such as maximum likelihood or maximum parsimony. If
the latter is used for inferring an initial tree, <code>TNT</code> is a
popular alternative to use. However, its format is specific to the
program and differs from standard newick, so it is impossible to use it
as initial tree in other types of analyses. <code>tbea</code> has a
function for converting from TNT tree format to standard newick, thus
allowing to use parsimony trees as initial proposals in Bayesian
programs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaballench/tbea" class="external-link">tbea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a file with multiple trees in TNT format</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tread 'three arbitrary trees in TNT format'"</span>, </span>
<span>                  <span class="st">"(Taxon_A ((Taxon_B Taxon_C)(Taxon_D Taxon_E)))*"</span>, </span>
<span>                  <span class="st">"(Taxon_A (Taxon_B (Taxon_C (Taxon_D Taxon_E))))*"</span>, </span>
<span>                  <span class="st">"(Taxon_A (Taxon_C (Taxon_B (Taxon_D Taxon_E))));"</span>, </span>
<span>                  <span class="st">"proc-;"</span><span class="op">)</span>,</span>
<span>           con <span class="op">=</span> <span class="st">"someTrees.tre"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert TNT to newick</span></span>
<span><span class="fu"><a href="../reference/tnt2newick.html">tnt2newick</a></span><span class="op">(</span>file<span class="op">=</span><span class="st">"someTrees.tre"</span>, return<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "(Taxon_A,((Taxon_B,Taxon_C),(Taxon_D,Taxon_E)));"</span></span>
<span><span class="co">## [2] "(Taxon_A,(Taxon_B,(Taxon_C,(Taxon_D,Taxon_E))));"</span></span>
<span><span class="co">## [3] "(Taxon_A,(Taxon_C,(Taxon_B,(Taxon_D,Taxon_E))));"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cleanup after the example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"someTrees.tre"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>In order to generate a tree in which node times are consistent with
the calibration priors we can use a fast method such as penalized
likelihood (implemented in the <code>ape</code> package) using the
initial tree and our set of node calibrations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read tree with ape</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">"(Acestrorhynchus_falcirostris:0.1296555,</span></span>
<span><span class="st">                        ((((Cynodon_gibbus:0.002334399,Cynodon_septenarius:0.00314063)</span></span>
<span><span class="st">                        :0.07580842,((Hydrolycus_scomberoides:0.007028806,Hydrolycus_MUN_16211</span></span>
<span><span class="st">                        :0.009577958):0.0225477,(Hydrolycus_armatus:0.002431794,</span></span>
<span><span class="st">                        Hydrolycus_tatauaia:0.002788708):0.02830852):0.05110053)</span></span>
<span><span class="st">                        :0.02656745,Hydrolycus_wallacei:0.01814363):0.1712442,</span></span>
<span><span class="st">                        Rhaphiodon_vulpinus:0.04557667):0.1936416);"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get the node IDs according to the mrca of pairs of appropriate</span></span>
<span><span class="co"># species root</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/mrca.html" class="external-link">mrca</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">[</span><span class="st">"Acestrorhynchus_falcirostris"</span>, <span class="st">"Hydrolycus_armatus"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hydrolycus sensu stricto (cf. Hydrolycus)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/mrca.html" class="external-link">mrca</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">[</span><span class="st">"Hydrolycus_scomberoides"</span>, <span class="st">"Hydrolycus_armatus"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 15</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify calibrations as a data frame</span></span>
<span><span class="va">calibs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>node<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>                     age.min<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43</span>, <span class="fl">40.94</span><span class="op">)</span>,</span>
<span>                     age.max<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">41.6</span><span class="op">)</span>,</span>
<span>                     stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calibrate the tree with the information in calibs using ape</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">calibrated</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/chronos.html" class="external-link">chronos</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">tree</span>, calibration<span class="op">=</span><span class="va">calibs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Setting initial dates...</span></span>
<span><span class="co">## Fitting in progress... get a first set of estimates</span></span>
<span><span class="co">##          (Penalised) log-lik = -2.287137 </span></span>
<span><span class="co">## Optimising rates... dates... -2.287137 </span></span>
<span><span class="co">## Optimising rates... dates... -2.286842 </span></span>
<span><span class="co">## Optimising rates... dates... -2.286299 </span></span>
<span><span class="co">## Optimising rates... dates... -2.285826 </span></span>
<span><span class="co">## Optimising rates... dates... -2.285409 </span></span>
<span><span class="co">## Optimising rates... dates... -2.285041 </span></span>
<span><span class="co">## Optimising rates... dates... -2.284715 </span></span>
<span><span class="co">## Optimising rates... dates... -2.284423 </span></span>
<span><span class="co">## Optimising rates... dates... -2.284154 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283918 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283706 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283513 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283338 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283176 </span></span>
<span><span class="co">## Optimising rates... dates... -2.283028 </span></span>
<span><span class="co">## Optimising rates... dates... -2.282891 </span></span>
<span><span class="co">## Optimising rates... dates... -2.282766 </span></span>
<span><span class="co">## Optimising rates... dates... -2.282649 </span></span>
<span><span class="co">## Optimising rates... dates... -2.282541 </span></span>
<span><span class="co">## Optimising rates... dates... -2.282441</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Maximum number of dual iterations reached.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## log-Lik = -2.279378 </span></span>
<span><span class="co">## PHIIC = 52.56</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the calibrated tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">calibrated</span>, label.offset<span class="op">=</span><span class="fl">1.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/axisPhylo.html" class="external-link">axisPhylo</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fetch the plotted tree from the graphic environment</span></span>
<span><span class="va">plttree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="st">"last_plot.phylo"</span>, envir<span class="op">=</span><span class="va">.PlotPhyloEnv</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># process the node heights and reorder as needed</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">plttree</span><span class="op">$</span><span class="va">xx</span>, <span class="va">plttree</span><span class="op">$</span><span class="va">yy</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="va">nodes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">nodes</span>, <span class="va">calibs</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age.min"</span>, <span class="st">"age.max"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">nodes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"min"</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">nodes</span>, rev.min<span class="op">=</span><span class="op">-</span><span class="op">(</span><span class="va">nodes</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plttree</span><span class="op">$</span><span class="va">xx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">nodes</span>, rev.max<span class="op">=</span><span class="op">-</span><span class="op">(</span><span class="va">nodes</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">plttree</span><span class="op">$</span><span class="va">xx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the original calibrations as error bars</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html" class="external-link">arrows</a></span><span class="op">(</span>x0<span class="op">=</span><span class="va">nodes</span><span class="op">[</span>, <span class="st">"rev.max"</span><span class="op">]</span>, x1<span class="op">=</span><span class="va">nodes</span><span class="op">[</span>, <span class="st">"rev.min"</span><span class="op">]</span>,</span>
<span>       y0<span class="op">=</span><span class="va">nodes</span><span class="op">[</span>,<span class="st">"y"</span><span class="op">]</span>, y1<span class="op">=</span><span class="va">nodes</span><span class="op">[</span>,<span class="st">"y"</span><span class="op">]</span>,</span>
<span>       angle<span class="op">=</span><span class="fl">90</span>, length<span class="op">=</span><span class="fl">0.3</span>, lwd<span class="op">=</span><span class="fl">3</span>,</span>
<span>       code<span class="op">=</span><span class="fl">3</span>, col<span class="op">=</span><span class="st">"darkblue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">nodelabels</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">tiplabels</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="starting_tree_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write the tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/write.tree.html" class="external-link">write.tree</a></span><span class="op">(</span>phy<span class="op">=</span><span class="va">calibrated</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "(Acestrorhynchus_falcirostris:56.63484744,((((Cynodon_gibbus:22.10239036,Cynodon_septenarius:22.10239036):22.83581459,((Hydrolycus_scomberoides:20.57344414,Hydrolycus_MUN_16211:20.57344414):20.36655586,(Hydrolycus_armatus:20.57862347,Hydrolycus_tatauaia:20.57862347):20.36137653):3.998204946):2.031301698,Hydrolycus_wallacei:46.96950664):4.794354381,Rhaphiodon_vulpinus:51.76386102):4.870986415);"</span></span></code></pre>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gustavo A. Ballen, Sandra Reinales.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
